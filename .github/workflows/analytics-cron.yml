# Cron job para atualização diária de dados de analytics
# Executa todos os dias às 6h da manhã (horário de Brasília = 9h UTC)

name: Analytics Daily Update

on:
  schedule:
    # Todos os dias às 6h de Brasília (9h UTC)
    - cron: '0 9 * * *'
  
  # Permite execução manual
  workflow_dispatch:

jobs:
  update-analytics:
    runs-on: ubuntu-latest
    
    steps:
      - name: Trigger Analytics Update
        run: |
          # Chamar a API de atualização
          response=$(curl -s -w "\n%{http_code}" \
            "${{ secrets.APP_URL }}/api/cron/update-analytics?token=${{ secrets.CRON_SECRET }}")
          
          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | sed '$d')
          
          echo "Response: $body"
          echo "HTTP Code: $http_code"
          
          if [ "$http_code" != "200" ]; then
            echo "Error: API returned $http_code"
            exit 1
          fi
          
          echo "✅ Analytics updated successfully!"
        
      - name: Notify on failure
        if: failure()
        run: |
          echo "❌ Analytics update failed!"
          # Aqui poderia adicionar notificação por email/Slack

